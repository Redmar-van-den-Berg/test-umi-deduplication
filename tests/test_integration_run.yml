- name: integration-vanilla
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config.yaml
      reference=tests/data/reference/ref.fa
      --snakefile Snakefile
  files:
    - path: sample1/concat/forward.fastq.gz
    - path: sample1/concat/reverse.fastq.gz
    - path: sample1/concat/umi.fastq.gz
    - path: sample1/umi-trie/forward_dedup.fastq.gz
    - path: sample1/umi-trie/reverse_dedup.fastq.gz
    - path: sample1/umi-trie/umi_dedup.fastq.gz
    - path: log/sample1-umi-trie.txt
      contains:
        - Left after removing perfect duplicates
    - path: sample1/align/sample1.bam
    - path: sample1/sample1.umi.bam
    - path: sample1/sample1.umi.bam.bai
    - path: sample1/sample1.umi.dedup.bam

- name: integration-subsamples
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_subsamples.yaml
      reference=tests/data/reference/ref.fa
      --snakefile Snakefile
  files:
    - path: sample1/concat/forward.fastq.gz
    - path: sample2/concat/forward.fastq.gz
    - path: sample1/umi-trie/forward_dedup.fastq.gz
    - path: sample2/umi-trie/forward_dedup.fastq.gz
    - path: sample1/align/sample1.bam
    - path: sample2/align/sample2.bam
    - path: sample2/sample2.umi.bam
    - path: sample2/sample2.umi.bam.bai
    - path: sample2/sample2.umi.dedup.bam
