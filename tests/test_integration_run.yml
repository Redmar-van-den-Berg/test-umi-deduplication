- name: integration-vanilla
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs
      --latency-wait 5
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --singularity-prefix '~/.singularity/cache/snakemake'
      --config pepfile=tests/pep/project_config.yaml
      reference=tests/data/reference/ref.fa
      --snakefile Snakefile
      --notemp
  files:
    - path: sample1/concat/forward.fastq.gz
    - path: sample1/concat/reverse.fastq.gz
    - path: sample1/concat/umi.fastq.gz
    - path: humid/sample1/forward_dedup.fastq.gz
    - path: humid/sample1/reverse_dedup.fastq.gz
    - path: humid/sample1/umi_dedup.fastq.gz
    - path: humid/sample1/stats.dat
      contains:
        - 'total:'
    - path: log/sample1-humid.txt
      contains:
        - Reading data... done.
    - path: sample1/align/sample1.bam
    - path: sample1/sample1.umi.dedup.bam
    - path: umi-stats.tsv
      contains:
        - umi_trie_perc_duplicates
        - umi_tools_perc_duplicates
        - sample1
        - sample2
    - path: sample1/sample1.umi.forward.fastq.gz
      contains:
        - '@ERR2438055.20253_CCCCCCCC'
    - path: sample1/umi-tools/forward.fastq.gz
    - path: sample1/umi-tools/reverse.fastq.gz
    - path: sample1/umi-tools/umi.fastq.gz
    - path: sample1/umi-tools/umi-trie/forward_dedup.fastq.gz
    - path: sample1/umi-tools/umi-trie/stats.dat
    - path: sample1/umi-trie/umi-tools/sample1.umi.forward.fastq.gz
    - path: sample1/umi-trie/umi-tools/align/sample1.sam
    - path: sample1/umi-trie/umi-tools/align/sample1.bam
    - path: sample1/umi-trie/umi-tools/sample1.umi.dedup.bam
    # The pipeline should generate a MultiQC report file
    - path: multiqc_report.html
      contains:
        # The report should contain a section for HUMID
        - HUMID
        # The report should contain a section for UMI-Tools
        - UMI-tools 
        # The report should contain both samples
        - sample1
        - sample2

- name: integration-subsamples
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs
      --latency-wait 5
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --singularity-prefix '~/.singularity/cache/snakemake'
      --config pepfile=tests/pep/project_subsamples.yaml
      reference=tests/data/reference/ref.fa
      --snakefile Snakefile
  files:
    - path: sample1/concat/forward.fastq.gz
      should_exist: false
    - path: sample2/concat/forward.fastq.gz
      should_exist: false
    - path: humid/sample1/forward_dedup.fastq.gz
    - path: humid/sample2/forward_dedup.fastq.gz
    - path: sample1/align/sample1.bam
    - path: sample2/align/sample2.bam
    - path: sample2/sample2.umi.dedup.bam
